<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/header :: head}"></head>
<body>
<div th:replace="~{fragments/header :: nav}"></div>

<div class="container my-5">
    <div class="row">
        <div class="col-md-3">
            <div class="list-group">
                <a th:href="@{/professional/dashboard}" class="list-group-item list-group-item-action">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a th:href="@{/professional/profile}" class="list-group-item list-group-item-action">
                    <i class="fas fa-user"></i> My Profile
                </a>
                <a th:href="@{/professional/profile/edit}" class="list-group-item list-group-item-action active">
                    <i class="fas fa-edit"></i> Edit Profile
                </a>
                <a th:href="@{/professional/availability}" class="list-group-item list-group-item-action">
                    <i class="fas fa-calendar"></i> Availability
                </a>
            </div>
        </div>
        
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-user-edit"></i> Edit Professional Profile</h4>
                </div>
                <div class="card-body">
                    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
                    
                    <form th:action="@{/professional/profile/edit}" th:object="${profileDto}" method="post" enctype="multipart/form-data">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <input type="hidden" th:field="*{id}"/>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="bio" class="form-label">Professional Bio</label>
                                    <textarea class="form-control" th:field="*{bio}" rows="4" required></textarea>
                                    <div th:if="${#fields.hasErrors('bio')}" class="text-danger" th:errors="*{bio}"></div>
                                    <div class="form-text">Tell potential clients about your experience and expertise</div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="categoryId" class="form-label">Service Category</label>
                                        <select class="form-select" th:field="*{categoryId}" required>
                                            <option value="">Select Category</option>
                                            <option th:each="category : ${categories}" 
                                                    th:value="${category.id}" 
                                                    th:text="${category.name}"></option>
                                        </select>
                                        <div th:if="${#fields.hasErrors('categoryId')}" class="text-danger" th:errors="*{categoryId}"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="hourlyRate" class="form-label">Hourly Rate (â‚¹)</label>
                                        <input type="number" class="form-control" th:field="*{hourlyRate}" step="0.01" min="0">
                                        <div th:if="${#fields.hasErrors('hourlyRate')}" class="text-danger" th:errors="*{hourlyRate}"></div>
                                        <div class="form-text">Leave blank if you prefer to quote per project</div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="serviceAreaCity" class="form-label">Service City</label>
                                        <input type="text" class="form-control" th:field="*{serviceAreaCity}" required>
                                        <div th:if="${#fields.hasErrors('serviceAreaCity')}" class="text-danger" th:errors="*{serviceAreaCity}"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="serviceAreaState" class="form-label">Service State</label>
                                        <input type="text" class="form-control" th:field="*{serviceAreaState}" required>
                                        <div th:if="${#fields.hasErrors('serviceAreaState')}" class="text-danger" th:errors="*{serviceAreaState}"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="certification" class="form-label">Certification Details (Optional)</label>
                                    <textarea class="form-control" th:field="*{certification}" rows="3" 
                                              placeholder="List your certifications, licenses, or qualifications"></textarea>
                                    <div th:if="${#fields.hasErrors('certification')}" class="text-danger" th:errors="*{certification}"></div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <i class="fas fa-images"></i> Update Media
                                        </h6>
                                        
                                        <!-- Profile Photo Section -->
                                        <div class="mb-3">
                                            <label for="profilePhoto" class="form-label">New Profile Photo</label>
                                            <input type="file" class="form-control form-control-sm" 
                                                   id="profilePhoto" name="profilePhoto" accept="image/*">
                                            <div class="form-text small">JPEG or PNG (max 5MB)</div>
                                        </div>
                                        
                                        <!-- Certificates Section -->
                                        <div class="mb-3">
                                            <label for="certificates" class="form-label">Add More Certificates</label>
                                            <input type="file" class="form-control form-control-sm" 
                                                   id="certificates" name="certificates" 
                                                   accept=".pdf,.jpg,.jpeg,.png" multiple>
                                            <div class="form-text small">PDF, JPEG, or PNG (max 10MB each)</div>
                                        </div>
                                        
                                        <div class="alert alert-info small">
                                            <i class="fas fa-info-circle"></i>
                                            Only upload new files. Existing files will be preserved.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="text-muted small">
                                <i class="fas fa-clock"></i> 
                                Profile updates are saved immediately
                            </div>
                            <div class="btn-group">
                                <a th:href="@{/professional/profile}" class="btn btn-outline-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Quick Actions Card -->
            <div class="card mt-3">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h6>
                    <div class="row">
                        <div class="col-md-4">
                            <button class="btn btn-outline-primary btn-sm w-100" 
                                    data-bs-toggle="modal" data-bs-target="#photoModal">
                                <i class="fas fa-camera"></i> Update Photo Only
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-success btn-sm w-100"
                                    data-bs-toggle="modal" data-bs-target="#certificatesModal">
                                <i class="fas fa-upload"></i> Add Certificates Only
                            </button>
                        </div>
                        <div class="col-md-4">
                            <a th:href="@{/professional/availability}" class="btn btn-outline-info btn-sm w-100">
                                <i class="fas fa-calendar"></i> Manage Availability
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Profile Photo Update Modal -->
<div class="modal fade" id="photoModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/professional/profile/photo}" method="post" enctype="multipart/form-data">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-camera"></i> Update Profile Photo
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="profilePhotoModal" class="form-label">Choose New Photo</label>
                        <input type="file" class="form-control" id="profilePhotoModal" 
                               name="profilePhoto" accept="image/*" required>
                        <div class="form-text">Upload a JPEG or PNG image (max 5MB)</div>
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        This will replace your current profile photo.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload"></i> Update Photo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Certificates Upload Modal -->
<div class="modal fade" id="certificatesModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form th:action="@{/professional/profile/certificates}" method="post" enctype="multipart/form-data">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-certificate"></i> Add Certificates
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="certificatesModalInput" class="form-label">Choose Certificate Files</label>
                        <input type="file" class="form-control" id="certificatesModalInput" 
                               name="certificates" accept=".pdf,.jpg,.jpeg,.png" multiple required>
                        <div class="form-text">Upload PDF, JPEG, or PNG files (max 10MB each)</div>
                    </div>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        New certificates will be added to your existing ones.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-upload"></i> Add Certificates
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div th:replace="~{fragments/header :: footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/file-validation1.js}"></script>
</body>
</html>